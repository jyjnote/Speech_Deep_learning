## ğŸ™ï¸ ìŒí–¥í•™ ê°œë… (Pitch, Energy, Duration, Formant, Prosody)

TTS ìŒí–¥ ëª¨ë¸ì€ ìŒì„±ì˜ "ë‚´ìš©" ë¿ë§Œ ì•„ë‹ˆë¼, "í‘œí˜„ ë°©ì‹"ê¹Œì§€ ìì—°ìŠ¤ëŸ½ê²Œ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤.  
ì´ë¥¼ ìœ„í•´ ì¤‘ìš”í•œ **ìŒí–¥í•™ì  íŠ¹ì§•**ë“¤ì´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

---

## ğŸ“Œ 1. Pitch (F0)

**ì •ì˜:**  
PitchëŠ” ì‚¬ëŒì˜ ê·€ê°€ ëŠë¼ëŠ” **ì†Œë¦¬ì˜ ë†’ë‚®ì´**ë¥¼ ì˜ë¯¸í•˜ë©°, ì‹¤ì œ ë¬¼ë¦¬ì  ì¸¡ì • ê°’ì€ **ê¸°ë³¸ ì£¼íŒŒìˆ˜(F0, Fundamental Frequency)**ë¡œ í‘œí˜„ë©ë‹ˆë‹¤.

- ë‹¨ìœ„: Hz (í—¤ë¥´ì¸ )
- ë‚¨ì„± í‰ê· : ì•½ 80~150Hz
- ì—¬ì„± í‰ê· : ì•½ 150~300Hz

---

### ğŸ¯ ì˜ˆì‹œ: F0 ì¶”ì¶œ ë° ì‹œê°í™” (YIN ì•Œê³ ë¦¬ì¦˜)

```python
import librosa
import librosa.display
import matplotlib.pyplot as plt

y, sr = librosa.load("example.wav", sr=22050)
f0 = librosa.yin(y, fmin=50, fmax=500, sr=sr)

# ì‹œê°„ì¶• ìƒì„±
frames = range(len(f0))
t = librosa.frames_to_time(frames, sr=sr)

# ì‹œê°í™”
plt.figure(figsize=(10, 3))
plt.plot(t, f0, label='F0 (Pitch)', color='red')
plt.title("Pitch (F0) contour")
plt.xlabel("Time (s)")
plt.ylabel("Frequency (Hz)")
plt.grid(True)
plt.tight_layout()
plt.show()
```

---

## ğŸ“Œ 2. Energy

**ì •ì˜:**  
ì—ë„ˆì§€ëŠ” ìŒì„± ì‹ í˜¸ì˜ **ì„¸ê¸°(ê°•ë„)**ë¥¼ ë‚˜íƒ€ë‚´ë©°, **ë§ì†Œë¦¬ì˜ í¬ê¸°/ê°•ì¡°**ë¥¼ í‘œí˜„í•©ë‹ˆë‹¤.

- ë¬´ì„±ìŒ(ì‰¼, ì†ì‚­ì„): ë‚®ì€ energy
- ê³ ìŒëŸ‰ ë°œí™”, ê°ì • ê°•ì¡°: ë†’ì€ energy

---

### ğŸ¯ ì˜ˆì‹œ: ì—ë„ˆì§€ ê³„ì‚° ë° ì‹œê°í™”

```python
import numpy as np

S = librosa.feature.melspectrogram(y=y, sr=sr, n_fft=1024, hop_length=256, n_mels=80)
energy = np.linalg.norm(S, axis=0)

plt.figure(figsize=(10, 3))
plt.plot(librosa.frames_to_time(range(len(energy)), sr=sr, hop_length=256), energy)
plt.title("Energy contour")
plt.xlabel("Time (s)")
plt.ylabel("Energy")
plt.grid(True)
plt.tight_layout()
plt.show()
```

---

## ğŸ“Œ 3. Duration

**ì •ì˜:**  
ìŒì†Œ ë˜ëŠ” ìŒì ˆì´ ë°œìŒë˜ëŠ” **ê¸¸ì´(ì§€ì† ì‹œê°„)**  
TTSì—ì„œëŠ” ê° ë‹¨ì–´/ìŒì ˆ/ìŒì†Œê°€ ì–¼ë§ˆë‚˜ ì˜¤ë˜ ìœ ì§€ë˜ëŠ”ì§€ë¥¼ ëª¨ë¸ë§í•©ë‹ˆë‹¤.

- "ì‚¬ë‘í•´": ì‚¬â†—ë‘â†’í•´â†˜ (ê¸¸ì´ ë‹¤ë¦„)
- FastSpeech, VITS ë“±ì—ì„œ `Duration Predictor`ë¡œ ì‚¬ìš©ë¨

---

### ğŸ¯ ì˜ˆì‹œ: ìŒì†Œë³„ Duration ì˜ˆì‹œ (ê°œë…)

| ìŒì†Œ | ì‹œì‘ì‹œê°„ (s) | ì¢…ë£Œì‹œê°„ (s) | Duration (ms) |
|------|--------------|--------------|----------------|
| s    | 0.00         | 0.07         | 70             |
| a    | 0.07         | 0.18         | 110            |
| r    | 0.18         | 0.24         | 60             |

> â€» ì‹¤ì œ Durationì€ Forced Alignment ë„êµ¬ (ex. Montreal Forced Aligner) ë¡œ ì¶”ì¶œ
## ğŸ” Forced Alignmentì˜ ì›ë¦¬

**Forced Alignment (ê°•ì œ ì •ë ¬)** ì€  
ğŸ‘‰ "ìŒì„±(wav)"ê³¼ "ë¬¸ì¥ í…ìŠ¤íŠ¸"ë¥¼ ê¸°ë°˜ìœ¼ë¡œ  
ğŸ‘‰ "ê° ë‹¨ì–´Â·ìŒì†Œê°€ ìŒì„± ë‚´ì—ì„œ ì–´ë””ì— ìœ„ì¹˜í•˜ëŠ”ì§€" ìë™ìœ¼ë¡œ ì°¾ì•„ë‚´ëŠ” ì•Œê³ ë¦¬ì¦˜ì…ë‹ˆë‹¤.

---

## ğŸ“Œ ê¸°ë³¸ ì•„ì´ë””ì–´

> ğŸ§ ìŒì„±(wav) + ğŸ“„ í…ìŠ¤íŠ¸(label)  
> â†’ ğŸ“Š ì‹œê°„ì¶• ìœ„ì— "ì´ ë‹¨ì–´ëŠ” ì–¸ì œë¶€í„° ì–¸ì œê¹Œì§€"ë¼ëŠ” ì •ë³´ ì¶œë ¥

---

## ğŸ§  í•µì‹¬ êµ¬ì„±ìš”ì†Œ

| êµ¬ì„± ìš”ì†Œ       | ì„¤ëª…                                                                 |
|----------------|----------------------------------------------------------------------|
| ìŒí–¥ ëª¨ë¸       | ê° ìŒì†Œê°€ ì–´ë–¤ ì†Œë¦¬ íŠ¹ì„±ì„ ê°–ëŠ”ì§€ í•™ìŠµí•œ ëª¨ë¸ (ì˜ˆ: GMM-HMM, DNN-HMM) |
| ë°œìŒ ì‚¬ì „       | ë‹¨ì–´ â†’ ìŒì†Œ ì‹œí€€ìŠ¤ ë§¤í•‘ (`hello â†’ HH AH L OW`)                       |
| ë””ì½”ë”          | ì˜¤ë””ì˜¤ì— ê°€ì¥ ì˜ ë§ëŠ” ì‹œê°„-ìŒì†Œ ì‹œí€€ìŠ¤ë¥¼ ì°¾ìŒ (Viterbi decoding ì‚¬ìš©) |

---

## âš™ï¸ ë™ì‘ íë¦„ (Step-by-Step)

```text
1. "Hello my name is John" í…ìŠ¤íŠ¸ ì…ë ¥
2. ë°œìŒ ì‚¬ì „ìœ¼ë¡œ ìŒì†Œ ë³€í™˜ â†’ ["HH", "AH", "L", "OW", "M", "AY", ...]
3. ì˜¤ë””ì˜¤ë¥¼ í”„ë ˆì„ ë‹¨ìœ„ë¡œ ë‚˜ëˆ” (~10ms ë‹¨ìœ„)
4. ìŒí–¥ ëª¨ë¸ì´ ê° í”„ë ˆì„ì˜ ìŒì†Œ í™•ë¥ ì„ ì˜ˆì¸¡
5. Viterbi ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ ìµœì ì˜ íƒ€ì´ë° ì‹œí€€ìŠ¤ë¥¼ ì¶”ë¡ 
6. ê²°ê³¼ë¥¼ TextGrid ë“± ì‹œê°„ ì •ë³´ë¡œ ì¶œë ¥
```

---

## ğŸ”„ ì˜ˆì‹œ: Alignment ì˜ˆì¸¡ ì›ë¦¬

| í”„ë ˆì„ ì‹œì  (ì´ˆ) | ì˜ˆì¸¡ ìŒì†Œ í™•ë¥  (ì˜ˆì‹œ)        | ê°€ì¥ ê°€ëŠ¥ì„± ë†’ì€ ìŒì†Œ |
|------------------|------------------------------|------------------------|
| 0.00~0.01        | HH: 0.8, AH: 0.1, OW: 0.1     | HH                     |
| 0.01~0.02        | HH: 0.5, AH: 0.4, OW: 0.1     | HH                     |
| 0.02~0.03        | AH: 0.7, OW: 0.2, L: 0.1      | AH                     |
| 0.03~0.04        | AH: 0.4, L: 0.5, OW: 0.1      | L                      |

â†’ ë””ì½”ë”ê°€ **"HH: 0.00~0.02, AH: 0.02~0.03, L: 0.03~..."** ë¡œ ì¶”ì •

---

## ğŸ“š ìˆ˜í•™ì  ì›ë¦¬ ìš”ì•½

- **ì…ë ¥:** ìŒì„± íŒŒí˜• $x = \{x_1, x_2, ..., x_T\}$  
- **ëª©í‘œ:** ìŒì†Œ ì‹œí€€ìŠ¤ $y = \{y_1, y_2, ..., y_N\}$ ì™€ ì¼ì¹˜í•˜ë„ë¡  
- **ê²½ë¡œ ì¶”ì •:**  
  $$
  \arg\max_{a_1, ..., a_T} \prod_{t=1}^{T} P(x_t \mid a_t) \cdot P(a_t \mid a_{t-1})
  $$
  â†’ HMM + Viterbië¡œ ìµœì  ê²½ë¡œ ì¶”ë¡ 

---

## ğŸ§  ì™œ ì¤‘ìš”í•œê°€?

| í™œìš© | ì„¤ëª… |
|------|------|
| TTS Duration í•™ìŠµ | FastSpeech, VITS ë“±ì—ì„œ ê° ìŒì†Œì˜ ê¸¸ì´ë¥¼ ì˜ˆì¸¡í•˜ê¸° ìœ„í•´ GT duration í•„ìš” |
| ìŒì„± ì¸ì‹ í•™ìŠµ | ì…ë ¥ ìŒì„±ê³¼ í…ìŠ¤íŠ¸ë¥¼ ì •ë ¬í•´ supervised í•™ìŠµ ê°€ëŠ¥ |
| ê°ì • ë¶„ì„ | ë°œí™” ì†ë„/ê°•ì„¸/ê¸¸ì´ íŒ¨í„´ íŒŒì•… ê°€ëŠ¥ |
| í‰ê°€ ì§€í‘œ | ì‹¤ì œ ë°œí™” ì†ë„ì™€ ì •ë ¬ ì •í™•ë„ë¥¼ ìˆ˜ì¹˜ë¡œ ì¸¡ì • ê°€ëŠ¥ |

---

## ğŸ› ï¸ ì‚¬ìš© ê°€ëŠ¥í•œ ì•Œê³ ë¦¬ì¦˜/ë„êµ¬

| ë„êµ¬               | íŠ¹ì§•                             |
|--------------------|----------------------------------|
| Montreal Forced Aligner (MFA) | ê°€ì¥ ë„ë¦¬ ì“°ì„, ì •í™•ë„ ìš°ìˆ˜, ë‹¤êµ­ì–´ ì§€ì› |
| Gentle             | ì›¹ ê¸°ë°˜, CMUdict ê¸°ë°˜, ê°„í¸í•¨    |
| Aeneas             | í…ìŠ¤íŠ¸-ì˜¤ë””ì˜¤ ì •ë ¬ (MP3 ë“±)      |
| Prosodylab-Aligner | Kaldi ê¸°ë°˜, ê³ ì „ì ì¸ HMM ë°©ì‹     |

---

## âœ… ìš”ì•½

> Forced Alignmentì€ **ìŒì„±ê³¼ í…ìŠ¤íŠ¸ë¥¼ ì‹œê°„ì¶• ìœ„ì— ì •ë ¬**í•´ì£¼ëŠ” ê¸°ìˆ ë¡œ,  
> TTS ëª¨ë¸ì˜ ìì—°ìŠ¤ëŸ¬ìš´ íƒ€ì´ë° í•™ìŠµì— í•„ìˆ˜ì ì¸ ê¸°ë°˜ ë°ì´í„°ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
## â±ï¸ Forced Alignment & Duration ì¶”ì¶œ

**Forced Alignment (ê°•ì œ ì •ë ¬)** ì€ **ì˜¤ë””ì˜¤**ì™€ **ë¬¸ì¥ í…ìŠ¤íŠ¸**ë¥¼ ì…ë ¥ìœ¼ë¡œ ë°›ì•„  
**ê° ìŒì†Œ/ë‹¨ì–´ê°€ ì–¸ì œ ì‹œì‘í•˜ê³  ëë‚˜ëŠ”ì§€ ì‹œê°„ ì •ë³´ë¥¼ ì¶”ì¶œí•˜ëŠ” ì‘ì—…**ì…ë‹ˆë‹¤.

TTSì—ì„œ **Duration**ì€ ì´ ê°•ì œ ì •ë ¬ì„ í†µí•´ ì¶”ì¶œí•©ë‹ˆë‹¤.

---

### ğŸ› ï¸ ëŒ€í‘œ ë„êµ¬: Montreal Forced Aligner (MFA)

- ì˜¤ë””ì˜¤ì™€ ì •ë‹µ í…ìŠ¤íŠ¸ë¥¼ ì •ë ¬í•˜ì—¬ **ìŒì†Œ/ìŒì ˆ ë‹¨ìœ„ duration** ì¶”ì¶œ
- ë‹¤êµ­ì–´ ì§€ì› (í•œêµ­ì–´ë„ ê°€ëŠ¥)
- Kaldi ê¸°ë°˜, ì •í™•ë„ ë†’ìŒ
- ê²°ê³¼ë¥¼ `TextGrid` í˜•ì‹ìœ¼ë¡œ ì¶œë ¥ (Praat í˜¸í™˜)

---

## ğŸ“¦ ì„¤ì¹˜ ë°©ë²•

1. ê³µì‹ í™ˆí˜ì´ì§€ì—ì„œ ë°”ì´ë„ˆë¦¬ ì„¤ì¹˜  
   ğŸ‘‰ https://montreal-forced-aligner.readthedocs.io/

2. ì˜ˆì‹œ (Linux / Mac):

```bash
conda create -n aligner python=3.8
conda activate aligner
pip install montreal-forced-aligner
```

3. ëª¨ë¸ ë‹¤ìš´ë¡œë“œ

```bash
mfa model download acoustic english
mfa model download dictionary english
```

---

## ğŸ“ í´ë” êµ¬ì¡° ì˜ˆì‹œ

```
alignment_data/
â”œâ”€â”€ wav/                 â† ì˜¤ë””ì˜¤ íŒŒì¼ë“¤ (.wav)
â”‚   â””â”€â”€ hello.wav
â”œâ”€â”€ lab/                 â† í…ìŠ¤íŠ¸ íŒŒì¼ë“¤ (.lab or .txt, ì˜¤ë””ì˜¤ì™€ ë™ì¼ ì´ë¦„)
â”‚   â””â”€â”€ hello.lab        (ë‚´ìš©: Hello, my name is John.)
```

---

## â–¶ï¸ ì‹¤í–‰ ëª…ë ¹ì–´

```bash
mfa align wav/ lab/ english_mfa english_out/
```

- `wav/`: ì˜¤ë””ì˜¤ ê²½ë¡œ
- `lab/`: í…ìŠ¤íŠ¸ ê²½ë¡œ
- `english_mfa`: ìŒí–¥ ëª¨ë¸
- `english_out/`: ê²°ê³¼ ì €ì¥ í´ë”

---

## ğŸ“„ ì¶œë ¥ ì˜ˆì‹œ: `hello.TextGrid`

```
IntervalTier: words
"Hello"   0.00 - 0.48
"my"      0.48 - 0.65
"name"    0.65 - 0.93
"is"      0.93 - 1.05
"John"    1.05 - 1.42

IntervalTier: phones
"HH"      0.00 - 0.05
"AH"      0.05 - 0.18
"L"       0.18 - 0.30
"OW"      0.30 - 0.48
...
```

### ğŸ¯ ì˜ë¯¸
| ë‹¨ì–´   | ì‹œì‘(s) | ë(s) | Duration(ms) |
|--------|---------|--------|----------------|
| Hello  | 0.00    | 0.48   | 480            |
| John   | 1.05    | 1.42   | 370            |

---

## ğŸ§ª Pythonìœ¼ë¡œ TextGrid íŒŒì‹±í•˜ê¸°

```python
# pip install textgrid
from textgrid import TextGrid

tg = TextGrid.fromFile("english_out/hello.TextGrid")

word_tier = tg.getFirst("words")
for interval in word_tier:
    print(f"{interval.mark}: {interval.minTime:.2f}s â†’ {interval.maxTime:.2f}s")
```

---

## ğŸ“Œ ìš”ì•½

| í•­ëª©                | ì„¤ëª…                                     |
|---------------------|------------------------------------------|
| ì…ë ¥                | ì˜¤ë””ì˜¤ íŒŒì¼ (.wav) + í…ìŠ¤íŠ¸ íŒŒì¼ (.lab)  |
| ì¶œë ¥                | ê° ìŒì†Œ/ë‹¨ì–´ì˜ ì‹œì‘~ë ì‹œê°„ (`TextGrid`) |
| í™œìš©                | TTSì˜ Duration predictor í•™ìŠµ ë“±         |
| ê¸°íƒ€ ë„êµ¬           | `Aeneas`, `Gentle`, `Prosodylab-aligner` ë“± |

---

## âœ… í™œìš© ì˜ˆ

- FastSpeech: í…ìŠ¤íŠ¸ â†’ duration â†’ ìŒí–¥
- VITS: duration ì œì–´ ê°€ëŠ¥í•œ expressive TTS
- í•™ìŠµëœ alignmentìœ¼ë¡œ attention-free ëª¨ë¸ êµ¬ì„± ê°€ëŠ¥


---

## ğŸ“Œ 4. Formant (í¬ë¨¼íŠ¸)

**ì •ì˜:**  
**Formant**ëŠ” ì‚¬ëŒì˜ ë°œì„± ê¸°ê´€(ì…, ì½”, í˜€ ë“±) êµ¬ì¡°ì— ì˜í•´ í˜•ì„±ë˜ëŠ” **ê³µëª… ì£¼íŒŒìˆ˜**ì…ë‹ˆë‹¤.

- F1, F2, F3 â€¦ ë¡œ ë‚˜íƒ€ëƒ„
- ëª¨ìŒ êµ¬ë¶„ì— ë§¤ìš° ì¤‘ìš” (ì˜ˆ: "ì•„" vs "ì´")

---

### ğŸ¯ ì˜ˆì‹œ: Formant ì¶”ì • (Praat, parselmouth ì´ìš©)

```python
# pip install praat-parselmouth
import parselmouth
snd = parselmouth.Sound("example.wav")
formant = snd.to_formant_burg()

times = [t for t in np.linspace(0, snd.duration, 100)]
f1 = [formant.get_value_at_time(1, t) for t in times]
f2 = [formant.get_value_at_time(2, t) for t in times]

plt.figure(figsize=(10, 3))
plt.plot(times, f1, label='F1')
plt.plot(times, f2, label='F2')
plt.title("Formant frequencies over time")
plt.xlabel("Time (s)")
plt.ylabel("Frequency (Hz)")
plt.legend()
plt.grid(True)
plt.tight_layout()
plt.show()
```

---

## ğŸ“Œ 5. Prosody (ìš´ìœ¨)

**ì •ì˜:**  
ProsodyëŠ” **ê°•ì„¸, ë†’ë‚®ì´, ë§ì˜ ë¹ ë¥´ê¸°** ë“± **ë¦¬ë“¬ê° ìˆëŠ” ë§íˆ¬**ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.  
ë¬¸ì¥ ì–µì–‘, ê°ì • í‘œí˜„, ì§ˆë¬¸/ëª…ë ¹ êµ¬ë¶„ ë“±ì— í•µì‹¬ì  ì—­í• .

---

### ğŸ¯ ì˜ˆì‹œ: Prosodyì— ë”°ë¥¸ ì˜ë¯¸ ë³€í™”

| ë¬¸ì¥             | ìš´ìœ¨ (Prosody)                              | ì˜ë¯¸                                 |
|------------------|---------------------------------------------|--------------------------------------|
| ì‚¬ë‘í•´.          | í‰íƒ„í•˜ê²Œ â†’ ë‚®ì€ F0, ì¼ì •í•œ duration         | ë‹´ë‹´í•œ ê³ ë°±                          |
| ì‚¬ë‘í•´â†—          | ì ì  ì˜¬ë¼ê° â†’ ìƒìŠ¹ F0, ì§§ì€ duration         | ì• êµìŠ¤ëŸ½ê±°ë‚˜ ë†€ë€ ê°ì •               |
| ì‚¬â†˜ë‘â†—í•´â†˜        | ê°ì • ê°•ì¡° â†’ pitch up/down, duration ê¸¸ê²Œ     | ê·¹ì ì´ê³  ê°•í•œ í‘œí˜„                   |

---

## ğŸ§  ìš”ì•½

| ê°œë…     | ì„¤ëª…                       | í™œìš© ì˜ˆì‹œ                    |
|----------|----------------------------|------------------------------|
| Pitch    | ìŒì˜ ë†’ë‚®ì´ (Hz)            | ì–µì–‘, ì§ˆë¬¸/í‰ì„œ êµ¬ë¶„         |
| Energy   | ë§ì˜ ì„¸ê¸°/ê°•ì¡°              | ê°ì •, ì†ì‚­ì„, ì†Œë¦¬ í¬ê¸° í‘œí˜„ |
| Duration | ê° ìŒì ˆì˜ ê¸¸ì´ (ms)         | ë¹ ë¥´ê²Œ/ì²œì²œíˆ ë§í•˜ê¸°         |
| Formant  | ê³µëª… ì£¼íŒŒìˆ˜ (F1, F2...)     | ëª¨ìŒ êµ¬ë¶„, ìŒì§ˆ íŠ¹ì„±         |
| Prosody  | ìš´ìœ¨: ë†’ë‚®ì´ + ê¸¸ì´ + ê°•ì„¸  | ê°ì • í‘œí˜„, ìì—°ìŠ¤ëŸ¬ìš´ ë§íˆ¬   |

---

ì´ëŸ¬í•œ ìš”ì†ŒëŠ” TTSì˜ **ìì—°ìŠ¤ëŸ¬ì›€, í‘œí˜„ë ¥, ê°ì •**ì„ í¬ê²Œ ì¢Œìš°í•©ë‹ˆë‹¤.  
ê³ ê¸‰ TTS ëª¨ë¸ì€ ì´ë“¤ íŠ¹ì„±ì„ **explicití•˜ê²Œ ì œì–´**í•˜ê±°ë‚˜ **ëª¨ë¸ì´ ìë™ í•™ìŠµ**í•˜ë„ë¡ ì„¤ê³„ë©ë‹ˆë‹¤.
