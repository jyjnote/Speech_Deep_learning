# ğŸŒªï¸ WaveGlow: A Flow-Based Generative Network for Speech Synthesis

---

## ğŸ“Œ ê°œìš”

**WaveGlow**ëŠ” NVIDIAê°€ ë°œí‘œí•œ **Flow ê¸°ë°˜ vocoder**ë¡œ  
**WaveNetì˜ ê³ ìŒì§ˆ**ê³¼ **Parallel WaveGANì˜ ì†ë„**ë¥¼ **ë™ì‹œì— ì¡ì€** ëª¨ë¸ì…ë‹ˆë‹¤.

> ğŸ¯ íŠ¹ì§•:
> - Autoregressive X â†’ ë³‘ë ¬ ìƒì„± O  
> - ê³ í’ˆì§ˆ ë©œ â†’ ìŒì„± ë³€í™˜  
> - ë‹¨ì¼ ë„¤íŠ¸ì›Œí¬ë¡œ êµ¬ì„± (GAN í•„ìš” ì—†ìŒ)

---

## ğŸ¯ í•µì‹¬ ì•„ì´ë””ì–´

WaveGlowëŠ” ë‘ ê°€ì§€ ì•„ì´ë””ì–´ë¥¼ ê²°í•©í•œ ëª¨ë¸:

| ì›ë¦¬            | ì„¤ëª…                                               |
|-----------------|----------------------------------------------------|
| **Glow (Flow)** | reversibleí•œ transformation â†’ density estimation ê°€ëŠ¥ |
| **WaveNet**     | ì˜¤ë””ì˜¤ë¥¼ ì¡°ê±´ë¶€ ëª¨ë¸ë§                             |

â†’ `mel-spectrogram â†’ waveform` ë³€í™˜ì„ flow ê¸°ë°˜ìœ¼ë¡œ ì§ì ‘ í•™ìŠµ

---

## ğŸ§¬ ì „ì²´ êµ¬ì¡°

```text
Input: mel-spectrogram (80 x T)
â†“
Upsample mel to match waveform length
â†“
Normal distribution sample z ~ N(0,1)
â†“
Glow Blocks (Affine Coupling + 1x1 invertible conv)
â†“
Output: waveform
```

---

## ğŸ§ª ì‘ë™ ì˜ˆì‹œ (PyTorch ê¸°ë°˜)

> NVIDIA ê³µì‹ ì½”ë“œ ê¸°ë°˜ ì¶”ì • ì˜ˆì‹œ

```python
import torch
import numpy as np
import soundfile as sf
from waveglow import model as glow

# 1. Mel-spectrogram ë¶ˆëŸ¬ì˜¤ê¸° (ì˜ˆ: 80 x T)
mel = np.load("mel_example.npy")
mel = torch.from_numpy(mel).unsqueeze(0).cuda()  # [1, 80, T]

# 2. WaveGlow ëª¨ë¸ ë¡œë“œ
waveglow = torch.load('waveglow_256channels_universal_v5.pt')['model']
waveglow.cuda().eval()

# 3. Mel â†’ waveform ë³€í™˜
with torch.no_grad():
    waveform = waveglow.infer(mel, sigma=0.6).float().cpu().numpy()[0]

# 4. ì €ì¥
sf.write("waveglow_output.wav", waveform, samplerate=22050)
```

---

## âš™ï¸ í•µì‹¬ êµ¬ì„± ìš”ì†Œ

### 1ï¸âƒ£ Invertible 1x1 Convolution
- ì±„ë„ í˜¼í•©ì„ ìœ„í•œ ê°€ì—­ì  ì»¨ë³¼ë£¨ì…˜
- `det(W)`ë¥¼ ì‚¬ìš©í•´ log-likelihood ê³„ì‚°ì— ê¸°ì—¬

---

### 2ï¸âƒ£ Affine Coupling Layer

```text
x = [x_a, x_b]
y_a = x_a
y_b = x_b * exp(s(x_a)) + t(x_a)
â†’ reversible transformation
```

- íŒŒë¼ë¯¸í„° `s()`ì™€ `t()`ëŠ” ì‘ì€ ë„¤íŠ¸ì›Œí¬ë¡œ í•™ìŠµ
- ì—­ë³€í™˜ë„ ì‰½ê²Œ ê°€ëŠ¥ â†’ `x_b = (y_b - t(x_a)) / exp(s(x_a))`

---

### 3ï¸âƒ£ Flow Block (ì „ì²´ êµ¬ì¡° ë°˜ë³µ)

```text
z â†’ [Flow1] â†’ [Flow2] â†’ ... â†’ waveform
```

- ë³´í†µ 12~20ê°œì˜ flow block ì‚¬ìš©
- ê° block: [ActNorm â†’ Invertible Conv â†’ Affine Coupling]

---

## ğŸ“ˆ ì‹œê°í™” ì˜ˆì‹œ (Mel â†’ Waveform)

```python
import librosa.display
import matplotlib.pyplot as plt

# mel ì‹œê°í™”
plt.figure(figsize=(10, 4))
librosa.display.specshow(mel.cpu()[0], sr=22050, hop_length=256, x_axis='time', y_axis='mel')
plt.title("Input Mel-spectrogram")
plt.colorbar()
plt.tight_layout()
plt.show()

# waveform ì‹œê°í™”
plt.figure(figsize=(10, 2))
plt.plot(waveform)
plt.title("WaveGlow Generated Waveform")
plt.tight_layout()
plt.show()
```

---

## ğŸ“Š Loss Function

- **Maximum Likelihood Estimation (MLE)**
- ì…ë ¥ì„ `z ~ N(0, I)`ë¡œ ë§µí•‘í•œ í›„ log-likelihood ê³„ì‚°

```math
\log p(x) = \log p(z) + \sum \log | \det J |
```

> `J`: ì „ì²´ flowì˜ Jacobian  
> `|det J|`: affine ë³€í™˜ê³¼ invertible convì—ì„œ ì¶”ì¶œ

---

## âœ… ì¥ë‹¨ì  ìš”ì•½

| í•­ëª©         | ì¥ì                                    | ë‹¨ì                               |
|--------------|----------------------------------------|-----------------------------------|
| ìŒì§ˆ         | WaveNet ìˆ˜ì¤€ì˜ ê³ ìŒì§ˆ                   | HiFi-GANë³´ë‹¤ ì•½ê°„ ë¶€ìì—°ìŠ¤ëŸ¬ì›€     |
| ì†ë„         | ë³‘ë ¬ ìƒì„±ìœ¼ë¡œ ë§¤ìš° ë¹ ë¦„                 | Diffusion vocoderì— ë¹„í•´ ì•„ì§ ëŠë¦¼  |
| êµ¬ì¡°         | ë‹¨ì¼ ë„¤íŠ¸ì›Œí¬ë¡œ GAN ì—†ì´ í•™ìŠµ ê°€ëŠ¥      | ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ í¼ (flow ë°˜ë³µ êµ¬ì¡°)   |
| ì•ˆì •ì„±       | ì•ˆì •ì ì¸ í•™ìŠµ                          | ë§¤ìš° ê¹Šì€ ë„¤íŠ¸ì›Œí¬ í•„ìš”           |

---

## ğŸ“˜ ë…¼ë¬¸ ì •ë³´

- **Title:** *WaveGlow: A Flow-based Generative Network for Speech Synthesis*
- **Authors:** Ryan Prenger et al. (NVIDIA, 2019)
- **Link:** https://arxiv.org/abs/1811.00002
- **Code:** https://github.com/NVIDIA/waveglow

---

## âœ… ì •ë¦¬

| í•­ëª©           | ì„¤ëª…                                   |
|----------------|----------------------------------------|
| ëª¨ë¸ ì¢…ë¥˜      | Flow-based non-autoregressive vocoder  |
| ì…ë ¥           | Mel-spectrogram                        |
| ì¶œë ¥           | Waveform (1D, float32)                 |
| í•™ìŠµ ë°©ì‹      | Maximum Likelihood (MLE)               |
| ìƒì„± ë°©ì‹      | ë³‘ë ¬ (sampling from Gaussian + inverse flow) |
| ì£¼ìš” êµ¬ì„±      | Affine Coupling, Invertible Conv       |

---

> ğŸ§ WaveGlowëŠ” **WaveNetì˜ í’ˆì§ˆ**ê³¼ **ë³‘ë ¬ì„±**ì„ ëª¨ë‘ ë‹¬ì„±í•œ  
> "Classic flow-based vocoder"ë¡œ ì´í›„ HiFi-GAN, DiffWaveì— ì˜í–¥ì„ ì£¼ì—ˆìŠµë‹ˆë‹¤.

